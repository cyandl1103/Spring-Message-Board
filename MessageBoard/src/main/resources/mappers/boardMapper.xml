<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mappers.board">
	<!-- SQL의 모든 쿼리들을 작성함 -->
	<!-- 모든 게시글 조회하기 -->
	<select id="list" resultType="com.board.domain.BoardDTO">
		select seq, subject, content, name, reg_date, readCount
		from board;
	</select>
	
	<!-- 현재 가장 큰 seq(번호) 가져오기 -->
	<select id="maxSeq" resultType="java.lang.Integer">
		select max(seq)
		from board;
	</select>
	
	<!-- 게시글 삽입 -->
	<insert id="register">
		insert into board(seq, subject, content, name, reg_date, readCount)
		values (#{seq}, #{subject}, #{content}, #{name}, #{reg_date},0);
	</insert>
	
	<!-- 댓글 삽입 -->
	<insert id="replyRegister">
		insert into board_reply (bseq, content, name, reg_date)
		values (#{bseq}, #{content}, #{name}, #{reg_date});
	</insert>
	
	<!-- 조회수 증가 -->
	<update id="updateReadCount">
		update
			board
		set
			readcount = readcount + 1
		where
			seq = #{seq};
	</update>
	
	<!-- 게시물 조회 -->
	<select id="view" resultType="com.board.domain.BoardDTO">
		select
			seq, subject, content, name, reg_date, readCount
		from
			board
		where
			seq = #{seq};
	</select>
	
	<!-- 게시물 삭제 -->
	<delete id="delete">
		delete from
			board
		where
			seq = #{seq};
	</delete>
	
	<!-- 게시물 삭제 -->
	<update id="update">
		update
			board
		set
			subject = #{subject}, 
			content = #{content}
		where
			seq = #{seq};
	</update>
	
	<!-- 제목 기준으로 게시물 검색 -->
	<select id="search" resultType="com.board.domain.BoardDTO">
		select seq, subject, content, name, reg_date, readCount
		from board
		where subject like CONCAT('%',#{subject},'%')
		order by seq desc
<!-- 			subject like #{subject}; -->
	
	</select>
	
	<!-- FOR PAGING -->	
		<!-- 	10개씩 select -->
		<!-- 	limit n1, n2 -->
		<!-- 	n1 :  skip 할 행의 수 -->
		<!-- 	n2 :  count 할 행의 수 -->
	<!-- 게시물 목록 -->	
	<select id="pageList" resultType="com.board.domain.BoardDTO">
		select seq, subject, content, name, reg_date, readCount 
		from board 
		order by seq desc
		limit #{skip},#{amount};
	</select>
	
	<!-- 총 게시물의 수 -->
	<select id="getTotal" resultType="int">
		select count(*) 
		from board;
	</select>
	
	<!-- 해당 제목을 가진 총 게시물의 수 -->
	<select id="getTotalSubject" resultType="int">
		select count(*) 
		from board
		where subject like CONCAT('%',#{subject},'%')
		order by seq desc;
	</select>
	
		<!-- 제목 기준으로 게시물 검색 -->
	<select id="pageSearch" resultType="com.board.domain.BoardDTO">
		select seq, subject, content, name, reg_date, readCount
		from board
		where subject like CONCAT('%',#{subject},'%')
		order by seq desc
		limit #{skip},#{amount};
<!-- 			subject like #{subject}; -->
	</select>
	
	<!-- 검색어 추천 - 중복 제거 -->
	<select id="recommendSearch" resultType="com.board.domain.BoardDTO">
		select distinct subject
		from board
		where subject like CONCAT('%',#{subject},'%')
		order by 
		    case when subject = #{subject} then 0
		    when subject like CONCAT(#{subject},'%') then 1
		    when subject like CONCAT('%',#{subject},'%') then 2
		    when subject like CONCAT('%',#{subject}) then 3
		    else 4 end;
		;
	</select>
	
	<select id="replyList" resultType="com.board.domain.ReplyDTO">
		select rseq, bseq, name, content, reg_date, re_step, re_level
		from board_reply
		where bseq = #{bseq};
	</select>

</mapper>